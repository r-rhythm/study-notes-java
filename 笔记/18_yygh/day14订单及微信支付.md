# 订单
## 流程分析
1. 根据排班 id 获取订单中的排班数据
2. 根据就诊人的 id 获取订单内的就诊人数据
3. 生成订单调用医院接口下单,医院返回成功后,返回相关数据
4. 将以上的数据存入订单表中
5. 订单生成成功,调用医院接口更新票号数量
6. 给就诊人发送短信
## 生产挂号订单接口
1. 新建订单服务模块,记得网关配置
2. 远程调用获取所需要的信息
    1. 远程调用获取排班及就诊人数据
    2. HttpClient 调用医院接口,获取相关信息
3. 将数据全部存入 OrderInfo 对象中操作这个对象存入表

## 生成订单后,更新号源的数量和发送短信
使用 [[RabbitMQ]] 将发送消息和更新号源数量的操作进行异步操作,减少系统的响应时间
- 使用 docker 安装
- 在共用模块 common 中创建 rabbit_utils 模块
- 封装一个发送消息的方法

流程分析
1. order 模块生成订单后,发送 mq 消息
2. hosp 模块接收消息后,更新号源数量
3. hosp 更新号源数量后发送消息
4. msm 短信模块接收到 hosp 发送的消息后,向就诊人发送短信
# 订单支付
[[微信支付]]
1. 订单模块引入微信支付相关依赖,**注意排除slf4j**日志
2. 创建通过订单id生成微信支付二维码的接口
	1. 根据订单id查询订单信息
	2. 向支付记录表中添加支付记录,状态为正在支付
		1. 通过orderId判断订单是否添加了支付记录
	3. 调用微信固定的接口地址,得到二维码地址等信息
		1. 先封装相关参数(appid/商户号mch_id/使用微信支付工具类生成的一个随机的字符串/body扫码后显示的内容)
		2. 使用HttpClient发送Post请求
	4. 封装微信接口返回的数据并返回
