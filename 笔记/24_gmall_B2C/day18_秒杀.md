# 业务分析
![[秒杀-流程图.png]]
一种为了引流等目的, 网络卖家以超低的价格发布产品, 所有买家在网上抢购的一种购物方式
限制因素
1. 库存限制: 商家通常都只会拿出一定数量的商品来参加秒杀
2. 时间限制: 秒杀通常是有固定的时间段
3. 购买量限制: 通常会限制账户的购买量, 在一个用户已经秒杀成功后, 不会再让这个账户再秒杀一次

# 实现思路
1. 定时任务: 每天凌晨将当天秒杀商品数据存入 [[Redis]] 缓存进行预热 
2. 状态位: 标识是否还有库存, 只要返回 1 即代表此商品可以秒杀. 将状态位存储在堆内存中 (速度最快)
3. 用户发起请求, 将秒杀请求发送给 [[RabbitMQ]], 返回是否秒杀成功 (解耦/限流)

# 搭建秒杀模块
1. 秒杀微服务模块 service-activity, 负责所有有关秒杀的业务处理
2. 远程 feign 模块, service-activity-client
3. 前端交互模块 web-all

# 更新状态位
在集群情况下, 只有使用 [[Redis#Redis 发布订阅模式]] 的发布订阅模式能保证同一个消息被多个程序所共享, 它和 mq 的区别在于, redis 的 publish 并不是竞争操作, 它所发布的消息所有监听这个客户端的节点都可以收到
状态位 1 为有库存, 0 为售罄

# 抢购码
只有在秒杀活动入口进行访问的用户才是合法请求, 前台请求时会携带抢购码, 没有抢购码的请求都不执行秒杀

# 秒杀接口整合
1. 根据 skuId 获取秒杀商品数据, 并在前台展示