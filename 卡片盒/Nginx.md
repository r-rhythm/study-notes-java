# 概述
> [!info] 什么是 Nginx
> - Nginx 是一个高性能的 Http 和反向代理服务器, 有着占用内存少, 并发能力强等 (2w) 优点

# Nginx 的作用
- 反向代理: 客户端将请求发送至 Nginx, 由 Nginx 将这个请求发送给一台指定的服务器进行处理, 不对外暴露服务器 IP
- 负载均衡: 将客户端发送的请求根据配置的[[负载均衡#策略|规则]]动态的分发给各个服务器, 减少单一服务器的压力, 提高服务器的承载上限
- 动静分离: 将静态页面与动态页面交由不同的服务器进行解析, 加快客户端的访问速度, 降低单个服务器的压力

# Nginx 常用命令
- 在 `/usr/local/nginx/sbin` 目录下执行 `./nginx`  命令启动 Nginx 服务
- 同目录下执行` ./nginx -s stop` 关闭服务
- 同目录下执行 `./nginx -s reload` 重新加载 Nginx

# 配置文件
>  默认的配置文件都存放在 Nginx 的安装目录 `/usr/local/nginx/conf` 下, 主要修改的是主配置文件 nginx. Conf
- 全局块: 从配置文件开始到 events 块间的区域, 主要设置一些会影响 Nginx 整体运行的配置指令
- Events 块: 主要涉及影响 Nginx 服务器与用户的网络连接, 这部分配置对 Nginx 性能影响较大, 灵活配置
- Http 块: 配置最频繁, 端口号/代理/缓存及日志等都在这个块下配置
    - Http 全局块
	    - Upstream 块, 配置负载均衡的**上游服务器**
    - Server 块: 配置代理/负载均衡/动静分离等都在这个块中进行配置,**一个 Nginx 可以配置多个 server**

# Location 配置匹配规则
-   = uri 为严格匹配, 它用于不包含正则表达式的 URL 之前, 优先级最高   
-   ^~ uri 不包含正则表达式, 优先级高于正则表达式 
-   ~ uri 表示包含正则表达式, 且区分大小写
-   ~\* uri 表示包含正则表达式, 不区分大小写

# Nginx 原理
> [!info] Nginx 原理
> 通俗的来讲, Nginx 的原理就是一个 master 和多个 worker 间的关系
> 1. Nginx 中有两种进程, master 和 worker。当有请求访问时, master 进行就会通知 worker 进程来处理这个请求。当有多个 worker 进程时, 就会来争抢这个请求, 一个请求只会被一个 worker 处理
> 4. Worker 通过异步非阻塞的方式来处理拿到的请求, 通过这种处理方式, 每个 worker 都可以将一个 CPU 的性能发挥到极致
> 5. 当 master 收到重新加载配置文件的指令后，会重新载入文件并根据文件开启新的进程，启用新的 worker 进程来接收请求，旧的 worker 在处理完手中的请求后便推出不再接收请求

# Nginx 细节补充
- Nginx 默认启动后会有两个进程, 一个 master 和一个 worker
- 在 Windows 环境下关闭启动窗口后 Nginx 不会停止, 使用 `nginx. exe -s stop` 命令结束进程
- Nginx 处理静态资源的最大并发值为 5W (*官方数量*)
- Worker 数量与 cpu 核数相等最为适宜, 避免了频繁切换上下文带来的性能损耗
- 采用 IO 多路复用机制